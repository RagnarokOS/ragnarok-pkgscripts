#!/usr/bin/perl

# $Ragnarok$

use strict;
use warnings;
use IPC::System::Simple qw(runx);
use PkgScripts::Emerge qw(emcmd);
use PkgScripts::Config qw($set_name);

my $file	= "/etc/portage/sets/$set_name";
my @cmdargs	= @ARGV;

# Get list of packages in @local to exclude.
open(my $fh, '<', $file)
	or die("Can't open $file: $!\n");
my $excluded	= do {
	local $/ = undef;
	<$fh>;
};
close($fh) or die("Can't close $file: $!\n");

$excluded =~ s/\s+/ /g;
emcmd('-av', '--depclean', "--exclude=$excluded", @cmdargs);
